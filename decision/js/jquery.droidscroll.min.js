/*! DroidScroll v1.3 - Copyright 2011 Elco Klingen - http://debeterevormgever.nl/software/droidscroll - License GPLv3: http://www.opensource.org/licenses/gpl-3.0 - Requires jQuery v1.5.2+: http://jquery.com/ */

(function(d,i,e,g){function h(a,b){var z=this;z.x=d.extend({direction:null,alignmentX:null,alignmentY:null,transDelay:500,barsDelay:1500,shootMax:15,scrollDist:100,keyDist:50,dragDist:3,focusAdd:10,useKeys:!1},b);z.a=d(a).addClass("droidscroll").wrapInner('<div class="ds-view'+(z.x.direction?" ds-view-"+z.x.direction:"")+'"/>');z.b=z.a.children(".ds-view");z.i=-(a.scrollLeft||z.a[0].scrollLeft);z.j=-(a.scrollTop||z.a[0].scrollTop);z.b.css({left:z.i, top:z.j});z.a[0].scrollTop=z.a[0].scrollLeft=a.scrollTop=a.scrollLeft=0;z.k=z.x.direction!=="v"?!0:!1;z.l=z.x.direction!=="h"?!0:!1;z.a.data("ds-moving",!1);if(z.k)z.c=d('<div class="ds-bar ds-bar-h"/>').appendTo(z.a),z.e=d('<div class="ds-track"/>').appendTo(z.c),z.g=d('<div class="ds-thumb"/>').appendTo(z.e);if(z.l)z.d=d('<div class="ds-bar ds-bar-v"/>').appendTo(z.a),z.f=d('<div class="ds-track"/>').appendTo(z.d), z.h=d('<div class="ds-thumb"/>').appendTo(z.f);d(i).bind("resize",function(){z.fj()});z.fj();z.b.bind("click",function(a){return z.fi(a)});z.b.bind("mousedown",function(a){return z.fe(a)});z.a.bind("DOMMouseScroll mousewheel",function(a){return z.fd(a)});z.x.useKeys&&(z.a.data("ds-scr",!0),d(e).keydown(function(a){return z.fc(a)}));z.b.find("a").each(function(){d(this).focus(function(a){return z.fk(a)})})} d.extend(h.prototype,{fa:function(a,b){var z=this;a=a==g?null:a;b=b==g?null:b;if(a!==null)z.i=a,z.b.css({left:z.i+"px"});if(b!==null)z.j=b,z.b.css({top:z.j+"px"});z.fn();z.fl()},fb:function(){var z=this,a,b;a=z.k&&z.i>0?0:null;a=z.k&&z.i<-(z.n-z.p)?-(z.n-z.p):a;b=z.l&&z.j>0?0:null;b=z.l&&z.j<-(z.m-z.o)?-(z.m-z.o):b;if(z.k&&z.n<z.p)switch(z.x.alignmentX){case null:case "l":a= 0;break;case "r":a=z.p-z.n;break;case "c":a=(z.p-z.n)/2}if(z.l&&z.m<z.o)switch(z.x.alignmentY){case null:case "t":b=0;break;case "b":b=z.o-z.m;break;case "c":b=(z.o-z.m)/2}a==null&&b==null||z.fa(a,b,!0)},fc:function(a){var z=this,b=null,c=null;if(z.a.data("ds-scr")){if((y=a.target.nodeName.toLowerCase())&&(y==="select"||y==="input"||y==="textarea"))return!0;switch(a.keyCode){case 33:c=z.l?z.j+z.o-z.x.keyDist: null;break;case 34:c=z.l?z.j-z.o+z.x.keyDist:null;break;case 35:c=z.l?-(z.m-z.o):null;break;case 36:c=z.l?0:null;break;case 37:b=z.k?z.i+z.x.keyDist:null;break;case 38:c=z.l?z.j+z.x.keyDist:null;break;case 39:b=z.k?z.i-z.x.keyDist:null;break;case 40:c=z.l?z.j-z.x.keyDist:null;break;default:return}b==null&&c==null||(z.fa(b,c),z.fb())}},fd:function(a){var z=this;b,c=b=null;b=a.wheelDelta? a.wheelDelta:-a.detail/3;b=b<-1?-1:b>1?1:b;b!=0&&(distance=b*b*(b>0?z.x.scrollDist:-z.x.scrollDist),distance!=0&&(b=z.k&&a.originalEvent.axis===1?z.i+distance:null,c=z.l&&a.originalEvent.axis!==1?z.j+distance:null,b==null&&c==null||(z.fa(b,c),z.fb())))},fe:function(a){var z=this;if((y=a.target.nodeName.toLowerCase())&&(y==="pre"||y==="code"||y==="input"||y==="textarea"))return!0; z.a.addClass("ds-grabbing");z.q=z.s=z.k?a.clientX:null;z.r=z.t=z.l?a.clientY:null;d(e).bind({mousemove:function(a){return z.ff(a)},mouseup:function(a){return z.fg(a)}});z.a.mouseleave(function(a){return z.fh(a)});a.preventDefault?a.preventDefault():a.returnValue=!1;return!1},ff:function(a){var z=this,b,c=null,d=null,e=(new Date).getTime();if(z.k){b=a.clientX-z.q;if(!z.a.data("ds-moving")&& b<z.x.dragDist&&b>-z.x.dragDist)return;c=z.i+b;z.s=!z.u||!(e-z.u<z.x.shootMax)?a.clientX:z.s;z.q=a.clientX}if(z.l){b=a.clientY-z.r;if(!z.a.data("ds-moving")&&b<z.x.dragDist&&b>-z.x.dragDist)return;d=z.j+b;z.t=!z.u||!(e-z.u<z.x.shootMax)?a.clientY:z.t;z.r=a.clientY}z.a.data("ds-moving",!0);z.fa(c,d);z.u=e;a.preventDefault?a.preventDefault(): a.returnValue=!1;return!1},fg:function(a){var z=this,b=null,c=null,b=z.k?z.i+(a.clientX-z.s):null,c=z.l?z.j+(a.clientY-z.t):null;z.fa(b,c);z.fb();d(e).unbind("mousemove mouseup");z.a.mouseleave(function(){});z.v=setTimeout(function(){z.a.data("ds-moving",!1);clearTimeout(z.v);z.v=null},z.x.transDelay);z.a.removeClass("ds-grabbing")},fh:function(a){var z=this;if(z.a.hasClass("ds-grabbing"))z.fg(a)}, fi:function(a){var z=this,b,c,e=null;b=null;if(z.a.data("ds-moving"))return a.preventDefault(),a.stopPropagation(),!1;if((y=a.target)&&y.href&&y.href.indexOf("#")!==-1)return b=d(y.href.substring(y.href.indexOf("#"))),c=b.offset(),e=-(z.k?c.left-z.i-parseInt(b.css("marginLeft"),10):z.i),b=-(z.l?c.top-z.j-parseInt(b.css("marginTop"),10):z.j),z.fa(e,b),a.preventDefault(),a.stopPropagation(),!1},fj:function(){var z=this,y=Math.round;z.o=z.a.height(); z.p=z.a.width();z.m=z.b.height();z.n=z.b.width();z.c&&z.g.css({width:z.p>=z.n?"100%":y(z.p/z.n*100)+"%"});z.d&&z.h.css({height:z.o>=z.m?"100%":y(z.o/z.m*100)+"%"});z.fn();z.fb()},fk:function(a){var z=this,b=null,c=null;z.a.scrollTop()>0&&z.a.scrollTop(0);if((y=a.target)&&y.offsetTop+y.offsetHeight>z.o)b=z.k?z.p-(y.offsetLeft+ y.offsetWidth)-z.x.focusAdd:null,c=z.l?z.o-(y.offsetTop+y.offsetHeight)-z.x.focusAdd:null,z.fa(b,c);a.preventDefault();return!1},fl:function(){var z=this;if(!(z.l&&z.m<z.o||z.k&&z.n<z.p))if(!(z.c&&z.c.hasClass("ds-bar-visible")||z.d&&z.d.hasClass("ds-bar-visible"))){z.c&&z.c.addClass("ds-bar-visible");z.d&&z.d.addClass("ds-bar-visible");if(z.w)clearTimeout(z.w),z.w= null;z.w=setTimeout(function(){z.fm();clearTimeout(z.w);z.w=null},z.x.barsDelay)}},fm:function(){var z=this;z.c&&z.c.removeClass("ds-bar-visible");z.d&&z.d.removeClass("ds-bar-visible")},fn:function(){var z=this;z.c&&z.g.css("left",-z.i/z.n*100+"%");z.d&&z.h.css("top",-z.j/z.m*100+"%")}});d.fn.extend({droidscroll:function(a){this.each(function(){d(this).data("ds",new h(this,a))});return this}})})(jQuery, window,document);
